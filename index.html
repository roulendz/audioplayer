<!DOCTYPE html>
<html>
	<head>
		<script src="https://cdn.tailwindcss.com"></script>
		<title></title>
		<link href="node_modules/froala-editor/css/froala_editor.pkgd.min.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="node_modules/froala-editor/js/froala_editor.pkgd.min.js"></script>
	</head>
	<body>
    <div class="sticky-container sticky top-12 z-20">
      <!-- Create the audio element and the buttons -->
      <audio id="audio" controls class="w-full">
        <source src="" type="audio/mpeg" />
        Your browser does not support the audio element.
	</audio>
	<div class="flex justify-center mt-2 space-x-2">
		<input type="file" id="fileInput" class="bg-blue-500 text-white p-2 m-4 px-4 py-3 rounded" accept="audio/*">
        <span id="speedDisplay" class="bg-blue-500 text-white p-2 m-4  px-4 py-3 rounded-lg">1.00</span>
        <button id="speedUp" class="bg-blue-500 text-white p-2 m-4 px-4 py-3 rounded">Speed Up ➕</button>
        <button id="speedDown" class="bg-blue-500 text-white p-2 m-4 px-4 py-3 rounded">Speed Down ➖</button>
        <button id="skipBackward" class="bg-blue-500 text-white p-2 m-4 px-4 py-3 rounded">Skip Backward ⏪</button>
        <button id="skipForward" class="bg-blue-500 text-white p-2 m-4 px-4 py-3 rounded">Skip Forward ⏩</button>
      </div>
    </div>
    <div class="flex justify-center mt-2 flex-wrap">
		<h2 class="text-3xl font-bold">Conspect</h2>
		<div id="textarea" class="text-large w-full"></div>
	</div>
		<script>
			window.onbeforeunload = function() {
			  return "Are you sure you want to leave this page?";
			};
		</script>
		<script>
			var editorContent = localStorage.getItem("editorContent");
			if (editorContent) {
				textarea.innerHTML = editorContent;
			}
			// Initialize the editor.
			var editor = new FroalaEditor('#textarea', {
			  // Change save interval (time in miliseconds).
			  saveInterval: 2500,

			  // Set the key for localStorage.
			  saveKey: 'editorContent',

			  events: {
			    'save.before': function () {
			      // Before save to localStorage.
			      console.log('Saving to localStorage...');
			    },

			    'save.after': function () {
			      // After successfully save to localStorage.
			      console.log('Saved to localStorage.');
			    },

			    'save.error': function () {
			      // Do something here in case of error.
			      console.log('Error saving to localStorage.');
			    }
			  }
			}, function () {

			  // Save the content to localStorage using the setItem method.
			editor.events.on('save.before', function () {
			  localStorage.setItem(editor.opts.saveKey, editor.html.get());
			  return false; // Prevent default save request.
			});

			// Load the content from localStorage using the getItem method.
			editor.events.on('initialized', function () {
			  var savedContent = localStorage.getItem(editor.opts.saveKey);
			  if (savedContent) {
			    editor.html.set(savedContent);
			  }
			});

			  });
		</script>
		<script>
			// Get the audio element
			var audio = document.getElementById("audio");


			// Get the audio element
			var audio = document.getElementById("audio");

			// Check if there is a saved time in local storage
			var savedTime = localStorage.getItem("audioTime");

      

			// If yes, set the audio current time to the saved time
			if (savedTime) {
			audio.currentTime = savedTime;
			}

			// Add an event listener to update the local storage when the audio time changes
			audio.addEventListener("timeupdate", function() {
			localStorage.setItem("audioTime", audio.currentTime);
			});

			// Get the textarea element
			var textarea = document.getElementById("textarea");

			// Define a timer variable
			var timer;

			// Define a function to pause the audio when typing
			function pauseAudio() {
			  // Clear the previous timer if any
			  clearTimeout(timer);

			  // Pause the audio
			  audio.pause();

			  // Set a new timer to resume the audio after 1 second of no typing
			  timer = setTimeout(resumeAudio, 500);
			}

      // Define a function to pause the audio when typing
			function pauseAudioPermanent() {
			  // Pause the audio
			  audio.pause();
			}

			// Define a function to resume the audio when not typing
			function resumeAudio() {
			  // Resume the audio
			  audio.play();
			}

      // Get the window object
      var win = window;

      // Add an event listener to the window object to call the pauseAudio function on blur
      win.addEventListener("blur", pauseAudioPermanent);

      // Add an event listener to the window object to call the resumeAudio function on focus
      win.addEventListener("focus", resumeAudio);

			// Add an event listener to the textarea to call the pauseAudio function on keypress
			textarea.addEventListener("keydown", pauseAudio);
      // Add an event listener to the textarea to call the pauseAudio function on keydown
      // Check if the key is one of the specified keys before calling pauseAudio
      textarea.addEventListener("keydown", function(event) {
        // Define an array of keys to pause the audio on
        var pauseKeys = ["Backspace", "Alt", "Control", "Space", "Shift", "Delete"];
        // Check if the event key is in the pauseKeys array
        if (pauseKeys.includes(event.key)) {
          // Call the pauseAudio function
          pauseAudio();
        }
      });

		</script>
		<script>
			// Get the audio element and the buttons
			var audio = document.getElementById("audio");
			var speedUp = document.getElementById("speedUp");
			var speedDown = document.getElementById("speedDown");
			var skipForward = document.getElementById("skipForward");
			var skipBackward = document.getElementById("skipBackward");

			// Get the span element to display the playback speed
			var speedDisplay = document.getElementById("speedDisplay");

			// Define the speed increment and the skip interval
			var speedIncrement = 0.05;
			var skipInterval = 2;

			// Add event listeners to the buttons
			speedUp.addEventListener("click", function() {
			// Increase the playback rate by the speed increment
			audio.playbackRate += speedIncrement;
			// Update the speed display
			speedDisplay.textContent = audio.playbackRate.toFixed(2);
			});

			speedDown.addEventListener("click", function() {
			// Decrease the playback rate by the speed increment
			audio.playbackRate -= speedIncrement;
			// Update the speed display
			speedDisplay.textContent = audio.playbackRate.toFixed(2);
			});

			skipForward.addEventListener("click", function() {
			// Skip forward by the skip interval
			audio.currentTime += skipInterval;
			});

			skipBackward.addEventListener("click", function() {
			// Skip backward by the skip interval
			audio.currentTime -= skipInterval;
			});

			// Add event listeners to the keyboard
			document.addEventListener("keydown", function(event) {
			  // Check if Control and Alt keys are pressed
			  if (event.ctrlKey && event.altKey) {
			    // Check if ArrowLeft key is pressed
			    if (event.key === "ArrowLeft") {
			      // Skip backward by the skip interval
			      audio.currentTime -= skipInterval;
			    }
			    // Check if ArrowRight key is pressed
			    else if (event.key === "ArrowRight") {
			      // Skip forward by the skip interval
			      audio.currentTime += skipInterval;
			    }
          if (event.key === "ArrowDown") {
			      // Skip backward by the skip interval
			      audio.playbackRate -= speedIncrement;
            // Update the speed display
			      speedDisplay.textContent = audio.playbackRate.toFixed(2);
			    }
			    // Check if ArrowRight key is pressed
			    else if (event.key === "ArrowUp") {
			      // Skip forward by the skip interval
			      audio.playbackRate += speedIncrement;
            // Update the speed display
			      speedDisplay.textContent = audio.playbackRate.toFixed(2);
			    }
			  }
      });
		</script>
		<script src="fileReader.js"></script>
	</body>
</html>